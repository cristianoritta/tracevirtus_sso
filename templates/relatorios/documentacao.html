{% extends 'layout/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    Documenta√ß√£o de Dados dos Relat√≥rios
                </div>

                <div class="card-body">


                    <pre style="white-space: pre-wrap; font-size: 1.2em;">
                    # Documenta√ß√£o - Relat√≥rio Financeiro do Caso

                    ## üìä Estrutura de Dados Retornados
                    
                    O dicion√°rio `data` retornado pela fun√ß√£o `relatorio_documento` cont√©m as seguintes chaves principais:
                    
                    ### 1. **rifs** (QuerySet de objetos RIF)
                    **Descri√ß√£o:** Lista de todos os RIFs (Relat√≥rios de Intelig√™ncia Financeira) associados ao caso.
                    
                    **Campos dispon√≠veis:**
                    - `id`: Identificador √∫nico do RIF
                    - `numero`: N√∫mero do RIF
                    - `caso`: Refer√™ncia ao caso associado
                    
                    **Como acessar:**
                    ```django
                    {% for rif in rifs %}
                        RIF n¬∫ { { rif.numero } } - ID: { { rif.id } }
                    {% endfor %}
                    ```
                    
                    ---
                    
                    ### 2. **comunicacoes** (QuerySet de objetos Comunicacao)
                    **Descri√ß√£o:** Todas as comunica√ß√µes financeiras registradas no caso.
                    
                    **Campos principais:**
                    - `campo_a`: Valor monet√°rio principal
                    - `campo_b`: Cr√©ditos
                    - `campo_c`: D√©bitos
                    - `informacoes_adicionais`: Detalhes textuais
                    - `indexador`: CPF/CNPJ do envolvido
                    
                    **Como acessar:**
                    ```django
                    { { % for com in comunicacoes % } }
                        Valor: { { com.campo_a } }
                        Informa√ß√µes: { { com.informacoes_adicionais } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 3. **envolvidos** (QuerySet de objetos Envolvido)
                    **Descri√ß√£o:** Pessoas f√≠sicas ou jur√≠dicas envolvidas no caso.
                    
                    **Campos dispon√≠veis:**
                    - `cpf_cnpj_envolvido`: Documento de identifica√ß√£o
                    - `nome_envolvido`: Nome completo
                    - `tipo_envolvido`: "Titular" ou "Representante"
                    - `indexador`: Chave de indexa√ß√£o
                    
                    **Como acessar:**
                    ```django
                    { { % for envolvido in envolvidos % } }
                        { { envolvido.nome_envolvido } } ({ { envolvido.tipo_envolvido } })
                        CPF/CNPJ: { { envolvido.cpf_cnpj_envolvido } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 4. **investigados** (QuerySet)
                    **Descri√ß√£o:** Lista de pessoas sob investiga√ß√£o no caso.
                    
                    **Como acessar:**
                    ```django
                    { { % for investigado in investigados % } }
                        Investigado: { { investigado.nome } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 5. **titulares** (Lista de dicion√°rios)
                    **Descri√ß√£o:** Envolvidos do tipo "Titular" com dados agregados de movimenta√ß√£o financeira.
                    
                    **Campos por titular:**
                    - `cpf_cnpj_envolvido`: Documento
                    - `nome_envolvido`: Nome
                    - `movimentacao`: Total movimentado (formatado)
                    - `creditos`: Total de cr√©ditos (formatado)
                    - `debitos`: Total de d√©bitos (formatado)
                    
                    **Como acessar:**
                    ```django
                    { { % for titular in titulares % } }
                        { { titular.nome_envolvido } }
                        CPF/CNPJ: { { titular.cpf_cnpj_envolvido } }
                        Movimenta√ß√£o Total: { { titular.movimentacao } }
                        Cr√©ditos: { { titular.creditos } } | D√©bitos: { { titular.debitos } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 6. **representantes** (Lista de dicion√°rios)
                    **Descri√ß√£o:** Envolvidos do tipo "Representante".
                    
                    **Estrutura similar aos titulares**
                    
                    **Como acessar:**
                    ```django
                    { { % for rep in representantes % } }
                        Representante: { { rep.nome_envolvido } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 7. **ocorrencias** (QuerySet de objetos Ocorrencia)
                    **Descri√ß√£o:** Eventos ou ocorr√™ncias registradas no caso.
                    
                    **Campos:**
                    - `ocorrencia`: Descri√ß√£o da ocorr√™ncia
                    - `rif`: RIF associado
                    
                    **Como acessar:**
                    ```django
                    { { % for ocor in ocorrencias % } }
                        { { ocor.ocorrencia } }
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ### 8. **movimentacao** (String formatada)
                    **Descri√ß√£o:** Valor total movimentado em todo o caso (soma de todas as comunica√ß√µes).
                    
                    **Como acessar:**
                    ```django
                    Total Movimentado no Caso: { { movimentacao } }
                    ```
                    
                    ---
                    
                    ### 9. **titulares_extratos** (Lista de dicion√°rios complexos)
                    **Descri√ß√£o:** An√°lise detalhada por titular com extrato completo de movimenta√ß√µes.
                    
                    **Estrutura por titular:**
                    ```python
                    {
                        'nome': str,                    # Nome do titular
                        'investigado': bool,             # Se √© investigado
                        'cpf': str,                      # CPF/CNPJ
                        'kyc': str,                      # An√°lise KYC (Know Your Client)
                        'movimentacao_total': str,       # Total movimentado formatado
                        'creditos': str,                 # Total de cr√©ditos formatado
                        'debitos': str,                  # Total de d√©bitos formatado
                        'comunicacoes': list,            # Lista de comunica√ß√µes do titular
                        'comunicacoes_nao_suspeitas': list,  # Comunica√ß√µes n√£o suspeitas
                        'outras_informacoes': list,      # Informa√ß√µes adicionais
                        'observacoes_analista': str,     # Observa√ß√µes do analista
                        'ocorrencias': list              # Ocorr√™ncias relacionadas
                    }
                    ```
                    
                    **Como acessar:**
                    ```django
                    { { % for extrato in titulares_extratos % } }
                        
                            { { extrato.nome } }
                            CPF: { { extrato.cpf } }
                            Movimenta√ß√£o Total: { { extrato.movimentacao_total } }
                            
                            Comunica√ß√µes:
                            { { % for com in extrato.comunicacoes % } }
                                RIF { { com.numero_rif } }: { { com.campo_a } }
                            { { % endfor % } }
                            
                            Ocorr√™ncias:
                            { { % for ocor in extrato.ocorrencias % } }
                                { { ocor.ocorrencia } }
                            { { % endfor % } }
                        
                    { { % endfor % } }
                    ```
                    
                    ---
                    
                    ## üéØ Casos de Uso Comuns
                    
                    ### 1. **Relat√≥rio Resumido do Caso**
                    ```django
                    
                        Relat√≥rio do Caso
                        Total de RIFs: { { rifs|length } }
                        Total de Comunica√ß√µes: { { comunicacoes|length } }
                        Movimenta√ß√£o Total: { { movimentacao } }
                        
                        
                        Principais Envolvidos
                        { { % for titular in titulares % } }
                            
                                { { titular.nome_envolvido } }
                                { { titular.movimentacao } }
                            
                        { { % endfor % } }
                    
                    ```
                    
                    ### 2. **Extrato Detalhado por Titular**
                    ```django
                    { { % for extrato in titulares_extratos % } }
                                { { extrato.nome } }
                                { { % if extrato.investigado % } }
                                    INVESTIGADO
                                { { % endif % } }
                            
                            
                                    Movimenta√ß√£o Total
                                    { { extrato.movimentacao_total } }
                                
                                
                                    Cr√©ditos
                                    { { extrato.creditos } }
                                
                                
                                    D√©bitos
                                    { { extrato.debitos } }
                                
                            
                            
                            { { % if extrato.kyc % } }
                                
                                    An√°lise KYC
                                    { { extrato.kyc } }
                                
                            { { % endif % } }
                            
                            { { % if extrato.observacoes_analista % } }
                                    Observa√ß√µes do Analista
                                    { { extrato.observacoes_analista } }
                                
                            { { % endif % } }
                    { { % endfor % } }
                    ```
                    
                    ### 3. **Dashboard de RIFs**
                    ```django
                        RIFs do Caso
                        <table>
                            <thead>
                                <tr>
                                    <th>N√∫mero</th>
                                    <th>Comunica√ß√µes</th>
                                    <th>Envolvidos</th>
                                    <th>Ocorr√™ncias</th>
                                </tr>
                            </thead>
                            <tbody>
                                { { % for rif in rifs % } }
                                <tr>
                                    <td>{ { rif.numero } }</td>
                                    <td>
                                        { { % for com in comunicacoes % } }
                                            { { % if com.rif.id == rif.id % } }
                                                +1
                                            { { % endif % } }
                                        { { % endfor % } }
                                    </td>
                                    <td>
                                        { { % for env in envolvidos % } }
                                            { { % if env.rif.id == rif.id % } }
                                                { { env.nome_envolvido } }<br>
                                            { { % endif % } }
                                        { { % endfor % } }
                                    </td>
                                    <td>
                                        { { % for ocor in ocorrencias % } }
                                            { { % if ocor.rif.id == rif.id % } }
                                                ‚Ä¢ { { ocor.ocorrencia|truncatewords:10 } }<br>
                                            { { % endif % } }
                                        { { % endfor % } }
                                    </td>
                                </tr>
                                { { % endfor % } }
                            </tbody>
                        </table>
                    
                    ```
                    
                    ### 4. **An√°lise de Rede de Relacionamentos**
                    ```django
                        Rede de Relacionamentos Financeiros
                        
                        { { % for extrato in titulares_extratos % } }
                                { { extrato.nome } }
                                
                                Transa√ß√µes com:
                                { { % for info in extrato.outras_informacoes % } }
                                    { { info|truncatewords:20 } }
                                { { % endfor % } }
                            
                        { { % endfor % } }
                    
                    ```
                    
                    ### 5. **Relat√≥rio de Ocorr√™ncias por RIF**
                    ```django
                        { { % regroup ocorrencias by rif.numero as ocorrencias_agrupadas % } }
                        
                        { { % for grupo in ocorrencias_agrupadas % } }
                                RIF n¬∫ { { grupo.grouper } }
                                    { { % for ocor in grupo.list % } }
                                        { { ocor.ocorrencia } }
                                    { { % endfor % } }
                        { { % endfor % } }
                    
                    ```
                    
                    ---
                    
                    ## üí° Insights e Melhores Pr√°ticas
                    
                    ### 1. **Filtros √öteis**
                    ```django
                    Apenas titulares com movimenta√ß√£o acima de R$ 100.000
                    { { % for titular in titulares % } }
                        { { % if titular.movimentacao|slice:"3:"|remove:"." > 100000 % } }
                            Alta movimenta√ß√£o: { { titular.nome_envolvido } }
                        { { % endif % } }
                    { { % endfor % } }
                    
                    Contar comunica√ß√µes suspeitas
                    { { % for extrato in titulares_extratos % } }
                        Comunica√ß√µes suspeitas: 
                        { { extrato.comunicacoes|length|sub:extrato.comunicacoes_nao_suspeitas|length } }
                    { { % endfor % } }
                    ```
                    
                    ### 2. **Agrega√ß√µes e Totaliza√ß√µes**
                    ```django
                    Somar todos os cr√©ditos
                    { { % with total_creditos=0 % } }
                        { { % for titular in titulares % } }
                            L√≥gica de soma aqui
                        { { % endfor % } }
                    { { % endwith % } }
                    
                    Percentual de participa√ß√£o
                    { { % for titular in titulares % } }
                        Participa√ß√£o: { { % widthratio titular.movimentacao movimentacao 100 % } }%
                    { { % endfor % } }
                    ```
                    
                    ### 3. **Formata√ß√£o Condicional**
                    ```django
                    { { % for extrato in titulares_extratos % } }
                        <div class="titular { { % if extrato.investigado % } }destaque-investigado{ { % endif % } }">
                            { { extrato.nome } }
                            
                            { { % if extrato.ocorrencias|length > 5 % } }
                                <span class="alerta">‚ö†Ô∏è M√∫ltiplas ocorr√™ncias
                            { { % endif % } }
                        
                    { { % endfor % } }
                    ```
                    
                    ### 4. **Exporta√ß√£o de Dados**
                    ```django
                    Formato CSV
                    { { % for titular in titulares % } }
                    { { titular.nome_envolvido } };{ { titular.cpf_cnpj_envolvido } };{ { titular.movimentacao } }
                    { { % endfor % } }
                    
                    Formato JSON simplificado
                    {
                        "caso": {
                            "total_movimentado": "{ { movimentacao } }",
                            "total_rifs": { { rifs|length } },
                            "titulares": [
                                { { % for t in titulares % } }
                                {
                                    "nome": "{ { t.nome_envolvido } }",
                                    "cpf": "{ { t.cpf_cnpj_envolvido } }",
                                    "valor": "{ { t.movimentacao } }"
                                }{ { % if not forloop.last % } },{ { % endif % } }
                                { { % endfor % } }
                            ]
                        }
                    }
                    ```
                    
                    ## üìù Notas Importantes
                    
                    - A formata√ß√£o monet√°ria √© feita pela fun√ß√£o `moeda()` - certifique-se de que est√° configurada corretamente
                    </pre>

                </div>
            </div>
        </div>
    </div>
</div>





{% endblock %}